module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){var r=n(23),s=n(4),o=s.Schema,i=new o({username:{type:String,lowercase:!0,trim:!0,unique:!0,dropDups:!0,required:!0},password_hash:{type:String,required:!0},email:{type:String,trim:!0,unique:"Email already exists",match:[/.+\@.+\..+/,"Please enter a valid email address"],required:!1},updated:Date,created:{type:Date,default:Date.now()},photo:{data:Buffer,contentType:String}});i.virtual("password").set(function(e){this.password_hash=this.encryptPassword(e)}).get(function(e){return this.password_hash}),i.methods={authenticate:function(e){return r.compare(e,this.password)},encryptPassword:function(e){if(!e)return"";try{return r.hashSync(e,5)}catch(e){return"Error:"+e}}};var u=s.model("User",i);e.exports=u},function(e,t,n){var r=n(0);e.exports={login:function(e,t,n){var r=e.isAuthenticated();r?e.signJWT(e.user).then(function(n){var s={jwt:n,isAuthenticated:r,username:e.user.username,message:"Login successful."};n.error?t.status(500).json(s):t.status(200).json(s)}).catch(function(e){t.status(500).send()}):t.status(401).send({jwt:null,isAuthenticated:r||!1,message:"Incorrect username or password."})},logout:function(e,t,n){e.logout();var r=e.isAuthenticated();r?t.status(500).json({isAuthentiated:r,message:"Logout NOT successful."}):t.status(205).json({isAuthentiated:r,message:"Logout successful."})},signup:function(e,t,n){var s={email:e.body.email,username:e.body.username,password:e.body.password};r.findOne({$or:[{email:s.email},{username:s.username}]},function(o,i){if(o)n(o);else if(i){var u=s.email===i.email?"email":"username";t.status(409).json({message:"That "+u+" already exists"})}else new r(s).save(function(r){r?t.status(500).json({message:"Signup unsuccessful."}):e.login({username:s.username,password:s.password},function(r){var s=e.isAuthenticated();r?n(r):e.signJWT(e.user).then(function(n){var r={jwt:n,isAuthenticated:s,username:e.user.username,message:"Signup successful."};t.status(200).json(r)}).catch(function(e){t.status(500).send()})})})})},auth:function(e,t){var n=e.isAuthenticated();return n?t.status(200).json({isAuthenticated:n}):t.status(401).send({isAuthenticated:n})}}},function(e,t,n){(function(t){n(9).config();var r=n(10),s=n(11),o=n(12),i=r.resolve(t,"../"),u=process.env.PORT||8e3,a=process.env.JWT_SECRET||"secret",c=process.env.JWT_EXPIRES||Date.now()+432e5,f=process.env.DB_URI||"mongodb://localhost/dtrack";e.exports={root:i,port:u,static:{dir:"./dist/public",index:"index.html",redirect:!1,fallthrough:!1},mongodb:{URI:f,connectionOpts:{useNewUrlParser:!0,useCreateIndex:!0,useUnifiedTopology:!0}},passport:{jwt:{secretOrKey:a,expires:c},session:{init:function(e,t){return{secret:o.generate(),genid:function(e){return s(10)},resave:!1,saveUninitialized:!0,cookie:{expires:c},store:new t({mongooseConnection:e.connection,collection:"dtrack-sessions"})}}}},jwt:{opts:{expires:c},secret:a},fabric:{local:{walletPath:"/Users/sethmartinez/.fabric-vscode/wallets/local_fabric_wallet",connectionFile:"/Users/sethmartinez/Desktop/PRJ/WWW/DTRACK/dtrack-web/server/api/fabric/local-connection.json",gatewayDiscovery:{enabled:!0,asLocalHost:!0}}}}}).call(this,"/")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("passport")},function(e,t,n){var r=n(24),s=n(7).Strategy,o=n(7).ExtractJwt,i=n(2),u=n(0),a=i.passport.jwt;a.jwtFromRequest=o.fromExtractors([o.fromHeader("Authorization"),o.fromBodyField("jwt"),function(e){var t=e.cookies;return t?t.jwt:null}]),t.Strategy=new s(a,function(e,t){if(!e)return t(null,!1);u.findOne({_id:e.id},function(n,r){return n?t(n,!1):r?Date.now()>e.expires?t("JWT expired.",!1):t(null,r):t(null,!1)})}),t.signJWT=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.jwt.secret,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.jwt.opts,s={id:e._id,expires:n.expires};return new Promise(function(e,n){r.sign(s,t,function(t,r){t?n({error:t,success:!1,token:null}):e({error:null,success:!0,token:r})})})},t.verifyJWT=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.jwt.secret;var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.jwt.opts;e._id,t.expires,t.verify;return new Promise(function(e,t){r.verify(verify,function(n,r){if(n)return t(n);e(r)})})}},function(e,t){e.exports=require("passport-jwt")},function(e,t,n){var r=n(2),s=n(13),o=n(6).signJWT,i=n(6).verifyJWT,u=n(27),a=n(28);s.use("/*",function(e,t,n){e.signJWT=o,e.verifyJWT=i,n()}),s.use(u),s.use(a),s.use("/*",function(e,t,n,r){console.error(e,"\n END"),n.headerSent||n.status(520).json({error:e.name+": "+e.message})}),s.listen(r.port,function(){return console.log("Listening on port ".concat(r.port))})},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("uid-safe")},function(e,t){e.exports=require("randomstring")},function(e,t,n){var r=n(3),s=n(14),o=n(15),i=n(16),u=n(17)(s),a=n(4),c=n(5),f=n(18),l=n(19),d=n(20),p=n(21),g=(n(22).seedAdmin(),n(2)),m=g.passport.session,h=r();h.use(r.static(g.static.dir,g.static.options)),h.use(f("dev")),h.use(o.urlencoded({extended:!0})),h.use(o.json()),h.use(i()),h.use(l()),h.use(d()),h.use(p()),a.connect(g.mongodb.URI,g.mongodb.connectionOpts),a.connection.once("open",function(){return console.log("MongoDB conection successful.")}),a.connection.on("error",function(){return console.error.bind(console,"MongoDB connection error:\r\n")}),h.use(s(m.init(a,u))),c.serializeUser(function(e,t){t(null,e)}),c.deserializeUser(function(e,t){User.findById(e,function(e,n){t(e,n)})}),h.use(c.initialize()),h.use(c.session()),"production"===h.get("env")&&(h.set("trust proxy",1),s.cookie.secure=!0),c.use(n(6).Strategy),c.use(n(25).Strategy),h.passport=c,e.exports=h},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("connect-mongo")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("cors")},function(e,t,n){var r=n(0);t.seedAdmin=function(){r.findOne({username:"admin"},function(e,t){return e?r.create({username:"admin",password:"password",email:"admin@dtrack.com"}):t})}},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){var r=n(0),s=n(26).Strategy;t.Strategy=new s(function(e,t,n){r.findOne({username:e},function(r,s){if(r||!s)return n(r,!1,{message:"Error finding user "+e});s.authenticate(t).then(function(e){e?n(null,s):n(null,!1,{message:"Wrong password"})})})})},function(e,t){e.exports=require("passport-local")},function(e,t,n){var r=n(3),s=n(5),o=n(1).signup,i=n(1).login,u=n(1).logout,a=n(1).auth,c=r.Router();c.route("/login").get(function(e,t){t.redirect("/#/login")}).post(s.authenticate("local",{session:!1}),i),c.route("/login/auth").get(s.authenticate("jwt"),a).post(s.authenticate("local",{session:!1}),i),c.route("/logout").get(u).post(u),c.route("/signup").get(function(e,t){t.redirect("/#/signup")}).post(o),e.exports=c},function(e,t,n){var r=n(3),s=n(5),o=n(29).profileController,i=r.Router();i.route("/user").get(s.authenticate("jwt",{session:!1}),function(e,t,n){t.redirect("/#/user")}).post(s.authenticate("jwt",{session:!1}),function(e,t,n){t.json({message:"NULL"})}),i.route("/user/profile").get(s.authenticate("jwt",{session:!1}),o),e.exports=i},function(e,t,n){var r=n(0);e.exports={profileController:function(e,t,n){var s=e.user._id;r.findOne({_id:s},"-password_hash").exec(function(e,n){if(e||!n)return t.status(500).json({message:"Internal Server error."});Rating.find({User:s},function(e,r){if(e)return t.status(500).json({message:"Internal Server error."});Custom.find({user:s},function(e,r){if(e)return t.status(500).json({message:"Internal Server error."});Result.find({user:s},function(e,r){if(e)return t.status(500).json({message:"Internal Server error."});console.log(r),t.status(302).json({message:"Success.",profile:n||[]})})})})})}}}]);